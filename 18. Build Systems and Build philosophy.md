# 18. 빌드 시스템과 빌드 철학

## 18.1 빌드 시스템의 목적

- 엔지니어들이 작성한 소스 코드를 기계가 읽을 수 있는 바이너리로 변환하는 것
- 훌륭한 빌드 시스템은 일반적으로 다음의 두 가지 중요 속성을 최적화한다.
  - 속도: 개발자가 명령 하나로 빌드를 수행하고 몇 초 안에 바이너리를 얻을 수 있어야 한다.
  - 정확성: 소스 파일과 기타 입력 데이터가 같다면 모든 개발자가 어떤 컴퓨터에서 빌드하더라도 항상 동일한 결과를 내어줘야 한다.
- 빌드 시스템은 사람만 이용하는 것이 아니라 테스트 목적으로 또는 프로덕션에 릴리즈하기 위해 머신들이 자동으로 빌드를 수행하기도 한다.
- 구글이 생각하는 '모던 빌드 시스템'이란 무엇이고 이런 시스템을 어떻게 활용하는지 이야기한다.

## 18.2 빌드 시스템이 없다면?

- 빌드 시스템은 더 큰 개발 프로젝트를 진행할 수 있게 해준다. 적절한 빌드 환경 없이 프로젝트 규모를 확장하려하면 온갖 난관에 부딪히게 된다.

### 18.2.1 컴파일러로 충분하지 않나?

- 소스 코드가 모두 같은 디렉터리에 위치한다면 다음 명령 하나로 전부 컴파일할 수 있다.
```bash
# 현재 디렉터리에 있는 모든 자바 소스 파일을 클래스 파일로 컴파일한다.
javac *.java
```
- `javac`도 코드에서 임포트한 파일이 현재 디렉터리의 하위 디렉터리에 있기만 하면 알아서 잘 찾아낸다. 하지만 다른 프로젝트와 공유하는 라이브러리처럼 파일시스템의 다른 곳에서 저장된 코드까지 찾아주지는 못한다.
- 자바 코드 외에는 빌드하는 방법을 알지 못한다. 특정 언어용 컴파일러 하나만으로는 시스템 전체를 빌드하기 어렵다.

### 18.2.2 셸 스크립트가 출동한다면?

- 잠시 동안은 괜찮겠지만 더 많은 문제가 드러난다.
  - 지루해진다. 시스템이 더 복잡해지면 어느 순간부터는 코딩에 투자하는 시간만큼을 빌드 스크립트에 쏟아야 한다. 셸 스크립트 디버깅은 고통스러운 일이며 꼼수에 꼼수가 덕지덕지 쌓여갈 것이다.
  - 느리다. 옛 버전 라이브러리에 의존하게 만드는 실수를 막으면 빌드 스크립트가 의존성들을 매번 정확한 순서로 빌드하도록 해야 한다. 다시 빌드해야 하는 부분만 검출해내는 로직을 직접 구상해낼 수는 있다. 하지만 이를 스크립트로 직접 관리하기에는 복잡할 뿐더러 오류가 스며들기 쉽다. 혹은 다시 빌드해야 하는 부분을 매번 명시하는 방법도 있지만, 셸 스크립트 이전으로 돌아가는 꼴이다.
  - 릴리즈할 때 최종 빌드를 만들기 위해 jar 명령에 건넬 인수를 모두 파악해 정리하고, 결과를 업로드하고 중앙 리포지터리에도 추가해야 한다. 문서자료도 새로 만들어 갱신하고, 사용자들에게 알려야 한다. 새로 짜야할 스크립트가 많아진다.
  - 하드 드라이브가 깨져서 전체 시스템을 다시 만들어야 한다면 소스 코드 버전을 관리하고 있었더라도 사용된 라이브러리까지 처음 다운로드한 것과 동일한 버전으로 맞출 수는 없다. 컴파일러를 작동시키기 위해 오래전에 설정해둔 환경변수를 알 방도가 없다.
  - 새로운 개발자가 팀에 합류할 때마다 똑같은 부트스트래핑 과정을 거쳐야 하므로 앞에서 겪은 문제가 다시 나타나도 큰 문제로 번지지는 않는다. 하지만 최선을 다했음에도 사람마다 시스템이 미묘하게 다르다. 한 사람의 컴퓨터에서 잘 동작하던 게 다른 사람의 컴퓨터에서는 그렇지 못한 일이 자주 생긴다. 그리고 그때마다 원인을 찾기 위해 도구 경로 라이브러리 버전을 확인해 디버깅하느라 몇 시간씩 허비하곤 한다.
  - 자동 빌드 시스템을 갖추기로 결심한다. 이론적으로는 새로운 컴퓨터를 장만하고 cron을 설정해 매일 밤 빌드 스크립트를 실행하면 되는 간단한 일이다. 하지만 여전히 고통스러운 설정 과정은 피할 수 없으며 사람이라면 쉽게 발견하고 해결했을 작은 문제들을 바로바로 처리하지 못하게 된다. 개발자들은 자기 컴퓨터에서는 잘 동작하는 코드를 밀어 넣고 퇴근하지만 여러 사람의 변경이 병합된 자도 빌드 시스템에서는 오류를 일으킬 가능성이 작지 않다. 그래서 매일 아침 출근하면 지난밤의 빌드가 깨져 있는 걸 목격하게 된다. 대부분 간단히 고칠 수 있지만 너무 자주 이래서 매일매일 많은 시간을 허비한다.
  - 프로젝트가 커지면서 빌드가 느려진다. 낭비되는 컴퓨팅 자원을 모두 활용할 방법이 있었으면 하는 생각을 해본다.
- 여러 명의 개발자와 여러 머신이 동원되기 시작하면 완벽한 비륻 스크립트라도 머신 사이의 미묘한 차이들을 매끄럽게 조율해주기 어려워진다. 이 시점이 되면 제대로 된 빌드 시스템에 투자해야 한다.
